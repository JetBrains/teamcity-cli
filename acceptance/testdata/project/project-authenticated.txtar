# Project commands requiring authentication.
[!has_token] skip 'requires authentication token'

exec teamcity api /app/rest/projects?locator=count:1&fields=project(id) --raw --no-input
extract '"id":"([^"]+)"' PROJECT_ID

# param set → get → list → delete
exec teamcity project param set Sandbox acceptance.test.param 'test-value-$RANDOM_STRING' --no-input
stdout 'Set parameter'
! stderr 'Error'

exec teamcity project param get Sandbox acceptance.test.param --no-input
stdout 'test-value'

# param list
exec teamcity project param list Sandbox --no-input
stdout 'NAME'
stdout 'VALUE'
! stderr 'Error'

# param list --json
exec teamcity project param list Sandbox --json --no-input
stdout '"count"'
! stderr 'Error'

exec teamcity project param delete Sandbox acceptance.test.param --no-input
stdout 'Deleted parameter'
! stderr 'Error'

# token put
exec teamcity project token put Sandbox 'acceptance-secret-$RANDOM_STRING' --no-input
stdout '.'
! stderr 'Error'

# settings status --json
exec teamcity project settings status $PROJECT_ID --json --no-input
! stderr 'Error'

# settings export --kotlin
exec teamcity project settings export $PROJECT_ID --kotlin -o $WORK/settings-kotlin.zip --no-input
! stderr 'Error'

# settings export --xml
exec teamcity project settings export $PROJECT_ID --xml -o $WORK/settings-xml.zip --no-input
! stderr 'Error'
